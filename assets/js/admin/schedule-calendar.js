webpackJsonp([7],{

/***/ 31:
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(32);


/***/ }),

/***/ 32:
/***/ (function(module, exports) {

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

(function ($, moment) {
  'use strict';

  var DATE_FORMAT = 'YYYY-MM-DD';

  var Selection = Backbone.Model.extend({
    defaults: {
      unit: null,
      endDate: null,
      startDate: null
    },

    validate: function validate(attrs, options) {
      // ...
    },
    clearSelectedDate: function clearSelectedDate(newUnit) {
      this.set({ startDate: null, endDate: null });
      this.set('unit', newUnit);
    },
    getNights: function getNights() {
      if (!this.has('endDate') || !this.has('startDate')) {
        return 0;
      }

      return this.get('endDate').diff(this.get('startDate'), 'days');
    }
  });

  var ScheduleCalendar = Backbone.View.extend({
    options: {
      debug: true,
      marker: '.awebooking-schedule__marker'
    },

    events: {
      'click .awebooking-schedule__day': 'setSelectionDate',
      'mouseenter .awebooking-schedule__day': 'drawMarkerOnHover'
    },

    initialize: function initialize() {
      this.model = new Selection();

      this.$marker = this.$el.find(this.options.marker);
      this.$marker.hide();

      $(document).on('keyup', this.keyup.bind(this));
      // $(document).off('keyup', this.keyup);

      this.listenTo(this.model, 'change:startDate change:endDate', this.setMarkerPosition);
      if (this.options.debug) {
        this.listenTo(this.model, 'change', this.debug);
      }

      this.$el.data('schedule-calendar', this);
    },
    debug: function debug() {
      if (this.model.has('startDate') && this.model.has('endDate')) {
        console.log(this.model.get('unit'), this.model.get('startDate').format(DATE_FORMAT) + ' - ' + this.model.get('endDate').format(DATE_FORMAT));
      } else if (this.model.has('startDate')) {
        console.log(this.model.get('unit'), this.model.get('startDate').format(DATE_FORMAT) + ' - null');
      } else if (this.model.has('endDate')) {
        console.log(this.model.get('unit'), 'null' + ' - ' + this.model.get('endDate').format(DATE_FORMAT));
      }
    },
    keyup: function keyup(e) {
      if (e.keyCode == 27) {
        this.model.clearSelectedDate();
      }
    },
    setSelectionDate: function setSelectionDate(e) {
      var $target = $(e.currentTarget);
      var setUnit = this.getUnitByElement($target);
      var clickDate = moment($target.data('date'));

      if (this.model.has('unit') && setUnit !== this.model.get('unit') || this.model.has('startDate') && this.model.has('endDate') || this.model.has('startDate') && clickDate.isBefore(this.model.get('startDate'), 'day')) {
        this.model.clearSelectedDate(setUnit);
      }

      if (!this.model.has('startDate') && !this.model.has('endDate')) {
        this.model.set('unit', setUnit);
        this.model.set('startDate', clickDate.clone());
      } else {
        this.model.set('endDate', clickDate.clone());
        this.trigger('apply', this.model, this);
        console.log(this.model.getNights());
      }
    },
    setMarkerPosition: function setMarkerPosition() {
      var endDate = this.model.get('endDate');
      var startDate = this.model.get('startDate');

      if (_.isNull(startDate) && _.isNull(endDate)) {
        this.$marker.css('width', 60).hide();
        return;
      }

      var $startDateEl = this.getElementByDate(this.model.get('unit'), startDate);
      if (_.isNull(endDate)) {
        var position = $startDateEl.position();
        this.$marker.show().css({ top: position.top, left: position.left });
      } else {
        var $endDateEl = this.getElementByDate(this.model.get('unit'), endDate);
        this.$marker.css('width', ($endDateEl.index() - $startDateEl.index() + 1) * 60);
      }
    },
    drawMarkerOnHover: function drawMarkerOnHover(e) {
      var $target = $(e.currentTarget);
      var targetUnit = this.getUnitByElement($target);

      if (!this.model.has('unit') || this.model.get('unit') !== targetUnit || !this.model.has('startDate') || this.model.has('startDate') && this.model.has('endDate')) {
        return;
      }

      var hoverDate = moment($target.data('date'));
      var startDate = this.model.get('startDate');

      if (startDate.isSameOrBefore(hoverDate, 'day')) {
        var $startDateEl = this.getElementByDate(targetUnit, startDate);
        this.$marker.css('width', ($target.index() - $startDateEl.index() + 1) * 60);
      }
    },
    getElementByDate: function getElementByDate(unit, date) {
      if ((typeof date === 'undefined' ? 'undefined' : _typeof(date)) === 'object') {
        date = date.format(DATE_FORMAT);
      }

      return this.$el.find('[data-unit="' + unit + '"]').find('.awebooking-schedule__day[data-date="' + date + '"]');
    },
    getUnitByElement: function getUnitByElement(element) {
      var unit = $(element).data('unit');

      if (typeof unit === 'undefined') {
        unit = $(element).parent().data('unit');
      }

      unit = parseInt(unit, 10);
      return !isNaN(unit) ? unit : 0;
    }
  });

  new ScheduleCalendar({
    el: '.awebooking-schedule'
  });
})(jQuery, TheAweBooking.momment || window.moment);

/***/ })

},[31]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hc3NldHMvanNzcmMvYWRtaW4vY2FsZW5kYXIvc2NoZWR1bGUtY2FsZW5kYXIuanMiXSwibmFtZXMiOlsiJCIsIm1vbWVudCIsIkRBVEVfRk9STUFUIiwiU2VsZWN0aW9uIiwiQmFja2JvbmUiLCJNb2RlbCIsImV4dGVuZCIsImRlZmF1bHRzIiwidW5pdCIsImVuZERhdGUiLCJzdGFydERhdGUiLCJ2YWxpZGF0ZSIsImF0dHJzIiwib3B0aW9ucyIsImNsZWFyU2VsZWN0ZWREYXRlIiwibmV3VW5pdCIsInNldCIsImdldE5pZ2h0cyIsImhhcyIsImdldCIsImRpZmYiLCJTY2hlZHVsZUNhbGVuZGFyIiwiVmlldyIsImRlYnVnIiwibWFya2VyIiwiZXZlbnRzIiwiaW5pdGlhbGl6ZSIsIm1vZGVsIiwiJG1hcmtlciIsIiRlbCIsImZpbmQiLCJoaWRlIiwiZG9jdW1lbnQiLCJvbiIsImtleXVwIiwiYmluZCIsImxpc3RlblRvIiwic2V0TWFya2VyUG9zaXRpb24iLCJkYXRhIiwiY29uc29sZSIsImxvZyIsImZvcm1hdCIsImUiLCJrZXlDb2RlIiwic2V0U2VsZWN0aW9uRGF0ZSIsIiR0YXJnZXQiLCJjdXJyZW50VGFyZ2V0Iiwic2V0VW5pdCIsImdldFVuaXRCeUVsZW1lbnQiLCJjbGlja0RhdGUiLCJpc0JlZm9yZSIsImNsb25lIiwidHJpZ2dlciIsIl8iLCJpc051bGwiLCJjc3MiLCIkc3RhcnREYXRlRWwiLCJnZXRFbGVtZW50QnlEYXRlIiwicG9zaXRpb24iLCJzaG93IiwidG9wIiwibGVmdCIsIiRlbmREYXRlRWwiLCJpbmRleCIsImRyYXdNYXJrZXJPbkhvdmVyIiwidGFyZ2V0VW5pdCIsImhvdmVyRGF0ZSIsImlzU2FtZU9yQmVmb3JlIiwiZGF0ZSIsImVsZW1lbnQiLCJwYXJlbnQiLCJwYXJzZUludCIsImlzTmFOIiwiZWwiLCJqUXVlcnkiLCJUaGVBd2VCb29raW5nIiwibW9tbWVudCIsIndpbmRvdyJdLCJtYXBwaW5ncyI6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TUFoS0gsRUFnS1dDLGNBQWNDLE9BQWQsSUFBeUJDLE9BQU81RSxNQWhLM0MsRSIsImZpbGUiOiIvanMvYWRtaW4vc2NoZWR1bGUtY2FsZW5kYXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oJCwgbW9tZW50KSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBjb25zdCBEQVRFX0ZPUk1BVCA9ICdZWVlZLU1NLUREJztcblxuICBjb25zdCBTZWxlY3Rpb24gPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe1xuICAgIGRlZmF1bHRzOiB7XG4gICAgICB1bml0OiBudWxsLFxuICAgICAgZW5kRGF0ZTogbnVsbCxcbiAgICAgIHN0YXJ0RGF0ZTogbnVsbCxcbiAgICB9LFxuXG4gICAgdmFsaWRhdGUoYXR0cnMsIG9wdGlvbnMpIHtcbiAgICAgIC8vIC4uLlxuICAgIH0sXG5cbiAgICBjbGVhclNlbGVjdGVkRGF0ZShuZXdVbml0KSB7XG4gICAgICB0aGlzLnNldCh7IHN0YXJ0RGF0ZTogbnVsbCwgZW5kRGF0ZTogbnVsbCB9KTtcbiAgICAgIHRoaXMuc2V0KCd1bml0JywgbmV3VW5pdCk7XG4gICAgfSxcblxuICAgIGdldE5pZ2h0cygpIHtcbiAgICAgIGlmICghIHRoaXMuaGFzKCdlbmREYXRlJykgfHwgISB0aGlzLmhhcygnc3RhcnREYXRlJykpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLmdldCgnZW5kRGF0ZScpLmRpZmYodGhpcy5nZXQoJ3N0YXJ0RGF0ZScpLCAnZGF5cycpO1xuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgU2NoZWR1bGVDYWxlbmRhciA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHtcbiAgICBvcHRpb25zOiB7XG4gICAgICBkZWJ1ZzogdHJ1ZSxcbiAgICAgIG1hcmtlcjogJy5hd2Vib29raW5nLXNjaGVkdWxlX19tYXJrZXInLFxuICAgIH0sXG5cbiAgICBldmVudHM6IHtcbiAgICAgICdjbGljayAuYXdlYm9va2luZy1zY2hlZHVsZV9fZGF5JzogJ3NldFNlbGVjdGlvbkRhdGUnLFxuICAgICAgJ21vdXNlZW50ZXIgLmF3ZWJvb2tpbmctc2NoZWR1bGVfX2RheSc6ICdkcmF3TWFya2VyT25Ib3ZlcicsXG4gICAgfSxcblxuICAgIGluaXRpYWxpemUoKSB7XG4gICAgICB0aGlzLm1vZGVsID0gbmV3IFNlbGVjdGlvbjtcblxuICAgICAgdGhpcy4kbWFya2VyID0gdGhpcy4kZWwuZmluZCh0aGlzLm9wdGlvbnMubWFya2VyKTtcbiAgICAgIHRoaXMuJG1hcmtlci5oaWRlKCk7XG5cbiAgICAgICQoZG9jdW1lbnQpLm9uKCdrZXl1cCcsIHRoaXMua2V5dXAuYmluZCh0aGlzKSk7XG4gICAgICAvLyAkKGRvY3VtZW50KS5vZmYoJ2tleXVwJywgdGhpcy5rZXl1cCk7XG5cbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5tb2RlbCwgJ2NoYW5nZTpzdGFydERhdGUgY2hhbmdlOmVuZERhdGUnLCB0aGlzLnNldE1hcmtlclBvc2l0aW9uKTtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGVidWcpIHtcbiAgICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCAnY2hhbmdlJywgdGhpcy5kZWJ1Zyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuJGVsLmRhdGEoJ3NjaGVkdWxlLWNhbGVuZGFyJywgdGhpcyk7XG4gICAgfSxcblxuICAgIGRlYnVnICgpIHtcbiAgICAgIGlmICh0aGlzLm1vZGVsLmhhcygnc3RhcnREYXRlJykgJiYgdGhpcy5tb2RlbC5oYXMoJ2VuZERhdGUnKSkge1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLm1vZGVsLmdldCgndW5pdCcpLCB0aGlzLm1vZGVsLmdldCgnc3RhcnREYXRlJykuZm9ybWF0KERBVEVfRk9STUFUKSArICcgLSAnICsgdGhpcy5tb2RlbC5nZXQoJ2VuZERhdGUnKS5mb3JtYXQoREFURV9GT1JNQVQpKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5tb2RlbC5oYXMoJ3N0YXJ0RGF0ZScpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMubW9kZWwuZ2V0KCd1bml0JyksIHRoaXMubW9kZWwuZ2V0KCdzdGFydERhdGUnKS5mb3JtYXQoREFURV9GT1JNQVQpICsgJyAtIG51bGwnKTtcbiAgICAgIH0gZWxzZSBpZih0aGlzLm1vZGVsLmhhcygnZW5kRGF0ZScpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMubW9kZWwuZ2V0KCd1bml0JyksICdudWxsJyArICcgLSAnICsgdGhpcy5tb2RlbC5nZXQoJ2VuZERhdGUnKS5mb3JtYXQoREFURV9GT1JNQVQpKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAga2V5dXAoZSkge1xuICAgICAgaWYgKGUua2V5Q29kZSA9PSAyNykge1xuICAgICAgICB0aGlzLm1vZGVsLmNsZWFyU2VsZWN0ZWREYXRlKCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIHNldFNlbGVjdGlvbkRhdGUoZSkge1xuICAgICAgY29uc3QgJHRhcmdldCA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICAgIGNvbnN0IHNldFVuaXQgPSB0aGlzLmdldFVuaXRCeUVsZW1lbnQoJHRhcmdldCk7XG4gICAgICBjb25zdCBjbGlja0RhdGUgPSBtb21lbnQoJHRhcmdldC5kYXRhKCdkYXRlJykpO1xuXG4gICAgICBpZiAodGhpcy5tb2RlbC5oYXMoJ3VuaXQnKSAmJiBzZXRVbml0ICE9PSB0aGlzLm1vZGVsLmdldCgndW5pdCcpXG4gICAgICAgICAgfHwgdGhpcy5tb2RlbC5oYXMoJ3N0YXJ0RGF0ZScpICYmIHRoaXMubW9kZWwuaGFzKCdlbmREYXRlJylcbiAgICAgICAgICB8fCB0aGlzLm1vZGVsLmhhcygnc3RhcnREYXRlJykgJiYgY2xpY2tEYXRlLmlzQmVmb3JlKHRoaXMubW9kZWwuZ2V0KCdzdGFydERhdGUnKSwgJ2RheScpKSB7XG4gICAgICAgIHRoaXMubW9kZWwuY2xlYXJTZWxlY3RlZERhdGUoc2V0VW5pdCk7XG4gICAgICB9XG5cbiAgICAgIGlmICghdGhpcy5tb2RlbC5oYXMoJ3N0YXJ0RGF0ZScpICYmICF0aGlzLm1vZGVsLmhhcygnZW5kRGF0ZScpKSB7XG4gICAgICAgIHRoaXMubW9kZWwuc2V0KCd1bml0Jywgc2V0VW5pdCk7XG4gICAgICAgIHRoaXMubW9kZWwuc2V0KCdzdGFydERhdGUnLCBjbGlja0RhdGUuY2xvbmUoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm1vZGVsLnNldCgnZW5kRGF0ZScsIGNsaWNrRGF0ZS5jbG9uZSgpKTtcbiAgICAgICAgdGhpcy50cmlnZ2VyKCdhcHBseScsIHRoaXMubW9kZWwsIHRoaXMpO1xuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLm1vZGVsLmdldE5pZ2h0cygpKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0TWFya2VyUG9zaXRpb24oKSB7XG4gICAgICBjb25zdCBlbmREYXRlID0gdGhpcy5tb2RlbC5nZXQoJ2VuZERhdGUnKTtcbiAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IHRoaXMubW9kZWwuZ2V0KCdzdGFydERhdGUnKTtcblxuICAgICAgaWYgKF8uaXNOdWxsKHN0YXJ0RGF0ZSkgJiYgXy5pc051bGwoZW5kRGF0ZSkpIHtcbiAgICAgICAgdGhpcy4kbWFya2VyLmNzcygnd2lkdGgnLCA2MCkuaGlkZSgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0ICRzdGFydERhdGVFbCA9IHRoaXMuZ2V0RWxlbWVudEJ5RGF0ZSh0aGlzLm1vZGVsLmdldCgndW5pdCcpLCBzdGFydERhdGUpO1xuICAgICAgaWYgKF8uaXNOdWxsKGVuZERhdGUpKSB7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gJHN0YXJ0RGF0ZUVsLnBvc2l0aW9uKCk7XG4gICAgICAgIHRoaXMuJG1hcmtlci5zaG93KCkuY3NzKHsgdG9wOiBwb3NpdGlvbi50b3AsIGxlZnQ6IHBvc2l0aW9uLmxlZnQgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCAkZW5kRGF0ZUVsID0gdGhpcy5nZXRFbGVtZW50QnlEYXRlKHRoaXMubW9kZWwuZ2V0KCd1bml0JyksIGVuZERhdGUpO1xuICAgICAgICB0aGlzLiRtYXJrZXIuY3NzKCd3aWR0aCcsICgkZW5kRGF0ZUVsLmluZGV4KCkgLSAkc3RhcnREYXRlRWwuaW5kZXgoKSArIDEpICogNjApO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBkcmF3TWFya2VyT25Ib3ZlcihlKSB7XG4gICAgICBjb25zdCAkdGFyZ2V0ID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgY29uc3QgdGFyZ2V0VW5pdCA9IHRoaXMuZ2V0VW5pdEJ5RWxlbWVudCgkdGFyZ2V0KTtcblxuICAgICAgaWYgKCF0aGlzLm1vZGVsLmhhcygndW5pdCcpXG4gICAgICAgIHx8IHRoaXMubW9kZWwuZ2V0KCd1bml0JykgIT09IHRhcmdldFVuaXRcbiAgICAgICAgfHwgIXRoaXMubW9kZWwuaGFzKCdzdGFydERhdGUnKVxuICAgICAgICB8fCB0aGlzLm1vZGVsLmhhcygnc3RhcnREYXRlJykgJiYgdGhpcy5tb2RlbC5oYXMoJ2VuZERhdGUnKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGhvdmVyRGF0ZSA9IG1vbWVudCgkdGFyZ2V0LmRhdGEoJ2RhdGUnKSk7XG4gICAgICBjb25zdCBzdGFydERhdGUgPSB0aGlzLm1vZGVsLmdldCgnc3RhcnREYXRlJyk7XG5cbiAgICAgIGlmIChzdGFydERhdGUuaXNTYW1lT3JCZWZvcmUoaG92ZXJEYXRlLCAnZGF5JykpIHtcbiAgICAgICAgY29uc3QgJHN0YXJ0RGF0ZUVsID0gdGhpcy5nZXRFbGVtZW50QnlEYXRlKHRhcmdldFVuaXQsIHN0YXJ0RGF0ZSk7XG4gICAgICAgIHRoaXMuJG1hcmtlci5jc3MoJ3dpZHRoJywgKCR0YXJnZXQuaW5kZXgoKSAtICRzdGFydERhdGVFbC5pbmRleCgpICsgMSkgKiA2MCk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGdldEVsZW1lbnRCeURhdGUodW5pdCwgZGF0ZSkge1xuICAgICAgaWYgKHR5cGVvZiBkYXRlID09PSAnb2JqZWN0Jykge1xuICAgICAgICBkYXRlID0gZGF0ZS5mb3JtYXQoREFURV9GT1JNQVQpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy4kZWxcbiAgICAgICAgLmZpbmQoJ1tkYXRhLXVuaXQ9XCInICsgdW5pdCArICdcIl0nKVxuICAgICAgICAuZmluZCgnLmF3ZWJvb2tpbmctc2NoZWR1bGVfX2RheVtkYXRhLWRhdGU9XCInICsgZGF0ZSArICdcIl0nKTtcbiAgICB9LFxuXG4gICAgZ2V0VW5pdEJ5RWxlbWVudChlbGVtZW50KSB7XG4gICAgICBsZXQgdW5pdCA9ICQoZWxlbWVudCkuZGF0YSgndW5pdCcpO1xuXG4gICAgICBpZiAodHlwZW9mIHVuaXQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHVuaXQgPSAkKGVsZW1lbnQpLnBhcmVudCgpLmRhdGEoJ3VuaXQnKTtcbiAgICAgIH1cblxuICAgICAgdW5pdCA9IHBhcnNlSW50KHVuaXQsIDEwKTtcbiAgICAgIHJldHVybiAhIGlzTmFOKHVuaXQpID8gdW5pdCA6IDA7XG4gICAgfSxcbiAgfSk7XG5cbiAgbmV3IFNjaGVkdWxlQ2FsZW5kYXIoe1xuICAgIGVsOiAnLmF3ZWJvb2tpbmctc2NoZWR1bGUnXG4gIH0pO1xuXG59KShqUXVlcnksIFRoZUF3ZUJvb2tpbmcubW9tbWVudCB8fCB3aW5kb3cubW9tZW50KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL2Fzc2V0cy9qc3NyYy9hZG1pbi9jYWxlbmRhci9zY2hlZHVsZS1jYWxlbmRhci5qcyJdLCJzb3VyY2VSb290IjoiIn0=