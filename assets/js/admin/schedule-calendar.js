webpackJsonp([8],{

/***/ 31:
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(32);


/***/ }),

/***/ 32:
/***/ (function(module, exports) {

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

(function ($, moment) {
  'use strict';

  var DATE_FORMAT = 'YYYY-MM-DD';

  var Selection = Backbone.Model.extend({
    defaults: {
      unit: null,
      endDate: null,
      startDate: null
    },

    validate: function validate(attrs, options) {
      // ...
    },
    clearSelectedDate: function clearSelectedDate(newUnit) {
      this.set({ startDate: null, endDate: null });
      this.set('unit', newUnit);
    },
    getNights: function getNights() {
      if (!this.has('endDate') || !this.has('startDate')) {
        return 0;
      }

      return this.get('endDate').diff(this.get('startDate'), 'days');
    }
  });

  var ScheduleCalendar = Backbone.View.extend({
    options: {
      debug: true,
      marker: '.awebooking-schedule__marker'
    },

    events: {
      'click .awebooking-schedule__day': 'setSelectionDate',
      'mouseenter .awebooking-schedule__day': 'drawMarkerOnHover'
    },

    initialize: function initialize() {
      this.model = new Selection();

      this.$marker = this.$el.find(this.options.marker);
      this.$marker.hide();

      $(document).on('keyup', this.keyup.bind(this));
      // $(document).off('keyup', this.keyup);

      this.listenTo(this.model, 'change:startDate change:endDate', this.setMarkerPosition);
      if (this.options.debug) {
        this.listenTo(this.model, 'change', this.debug);
      }

      this.$el.data('schedule-calendar', this);
    },
    debug: function debug() {
      if (this.model.has('startDate') && this.model.has('endDate')) {
        console.log(this.model.get('unit'), this.model.get('startDate').format(DATE_FORMAT) + ' - ' + this.model.get('endDate').format(DATE_FORMAT));
      } else if (this.model.has('startDate')) {
        console.log(this.model.get('unit'), this.model.get('startDate').format(DATE_FORMAT) + ' - null');
      } else if (this.model.has('endDate')) {
        console.log(this.model.get('unit'), 'null' + ' - ' + this.model.get('endDate').format(DATE_FORMAT));
      }
    },
    keyup: function keyup(e) {
      if (e.keyCode == 27) {
        this.model.clearSelectedDate();
      }
    },
    setSelectionDate: function setSelectionDate(e) {
      var $target = $(e.currentTarget);
      var setUnit = this.getUnitByElement($target);
      var clickDate = moment($target.data('date'));

      if (this.model.has('unit') && setUnit !== this.model.get('unit') || this.model.has('startDate') && this.model.has('endDate') || this.model.has('startDate') && clickDate.isBefore(this.model.get('startDate'), 'day')) {
        this.model.clearSelectedDate(setUnit);
      }

      if (!this.model.has('startDate') && !this.model.has('endDate')) {
        this.model.set('unit', setUnit);
        this.model.set('startDate', clickDate.clone());
      } else {
        this.model.set('endDate', clickDate.clone());
        this.trigger('apply', this.model, this);
        console.log(this.model.getNights());
      }
    },
    setMarkerPosition: function setMarkerPosition() {
      var endDate = this.model.get('endDate');
      var startDate = this.model.get('startDate');

      if (_.isNull(startDate) && _.isNull(endDate)) {
        this.$marker.css('width', 60).hide();
        return;
      }

      var $startDateEl = this.getElementByDate(this.model.get('unit'), startDate);
      if (_.isNull(endDate)) {
        var position = this.getCellPossiton($startDateEl);
        this.$marker.show().css({ top: position.top, left: position.left });
      } else {
        var $endDateEl = this.getElementByDate(this.model.get('unit'), endDate);
        this.$marker.css('width', ($endDateEl.index() - $startDateEl.index() + 1) * 60);
      }
    },
    drawMarkerOnHover: function drawMarkerOnHover(e) {
      var $target = $(e.currentTarget);
      var targetUnit = this.getUnitByElement($target);

      if (!this.model.has('unit') || this.model.get('unit') !== targetUnit || !this.model.has('startDate') || this.model.has('startDate') && this.model.has('endDate')) {
        return;
      }

      var hoverDate = moment($target.data('date'));
      var startDate = this.model.get('startDate');

      if (startDate.isSameOrBefore(hoverDate, 'day')) {
        var $startDateEl = this.getElementByDate(targetUnit, startDate);
        this.$marker.css('width', ($target.index() - $startDateEl.index() + 1) * 60);
      }
    },
    getElementByDate: function getElementByDate(unit, date) {
      if ((typeof date === 'undefined' ? 'undefined' : _typeof(date)) === 'object') {
        date = date.format(DATE_FORMAT);
      }

      return this.$el.find('[data-unit="' + unit + '"]').find('.awebooking-schedule__day[data-date="' + date + '"]');
    },
    getUnitByElement: function getUnitByElement(element) {
      var unit = $(element).data('unit');

      if (typeof unit === 'undefined') {
        unit = $(element).closest('[data-unit]').data('unit');
      }

      unit = parseInt(unit, 10);
      return !isNaN(unit) ? unit : 0;
    },
    getCellPossiton: function getCellPossiton(element) {
      var childPos = element.offset();
      var parentPos = this.$el.find('.awebooking-schedule__tbody').offset();

      return {
        top: childPos.top - parentPos.top,
        left: childPos.left - parentPos.left
      };
    }
  });

  new ScheduleCalendar({
    el: '.awebooking-schedule'
  });
})(jQuery, TheAweBooking.momment || window.moment);

/***/ })

},[31]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hc3NldHMvanNzcmMvYWRtaW4vY2FsZW5kYXIvc2NoZWR1bGUtY2FsZW5kYXIuanMiXSwibmFtZXMiOlsiJCIsIm1vbWVudCIsIkRBVEVfRk9STUFUIiwiU2VsZWN0aW9uIiwiQmFja2JvbmUiLCJNb2RlbCIsImV4dGVuZCIsImRlZmF1bHRzIiwidW5pdCIsImVuZERhdGUiLCJzdGFydERhdGUiLCJ2YWxpZGF0ZSIsImF0dHJzIiwib3B0aW9ucyIsImNsZWFyU2VsZWN0ZWREYXRlIiwibmV3VW5pdCIsInNldCIsImdldE5pZ2h0cyIsImhhcyIsImdldCIsImRpZmYiLCJTY2hlZHVsZUNhbGVuZGFyIiwiVmlldyIsImRlYnVnIiwibWFya2VyIiwiZXZlbnRzIiwiaW5pdGlhbGl6ZSIsIm1vZGVsIiwiJG1hcmtlciIsIiRlbCIsImZpbmQiLCJoaWRlIiwiZG9jdW1lbnQiLCJvbiIsImtleXVwIiwiYmluZCIsImxpc3RlblRvIiwic2V0TWFya2VyUG9zaXRpb24iLCJkYXRhIiwiY29uc29sZSIsImxvZyIsImZvcm1hdCIsImUiLCJrZXlDb2RlIiwic2V0U2VsZWN0aW9uRGF0ZSIsIiR0YXJnZXQiLCJjdXJyZW50VGFyZ2V0Iiwic2V0VW5pdCIsImdldFVuaXRCeUVsZW1lbnQiLCJjbGlja0RhdGUiLCJpc0JlZm9yZSIsImNsb25lIiwidHJpZ2dlciIsIl8iLCJpc051bGwiLCJjc3MiLCIkc3RhcnREYXRlRWwiLCJnZXRFbGVtZW50QnlEYXRlIiwicG9zaXRpb24iLCJnZXRDZWxsUG9zc2l0b24iLCJzaG93IiwidG9wIiwibGVmdCIsIiRlbmREYXRlRWwiLCJpbmRleCIsImRyYXdNYXJrZXJPbkhvdmVyIiwidGFyZ2V0VW5pdCIsImhvdmVyRGF0ZSIsImlzU2FtZU9yQmVmb3JlIiwiZGF0ZSIsImVsZW1lbnQiLCJjbG9zZXN0IiwicGFyc2VJbnQiLCJpc05hTiIsImNoaWxkUG9zIiwib2Zmc2V0IiwicGFyZW50UG9zIiwiZWwiLCJqUXVl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NUNtRCxtQkE3SDRDLDJCQTZINUJXLE9BN0g0QixFQTZIbkI7QUFDdkIsVUFBSUksV0FBV0osUUFBUUssTUFBUixFQUFmO0FBQ0EsVUFBSUMsWUFBWSxLQUFLL0MsR0FBTCxDQUFTQyxJQUFULENBQWMsNkJBQWQsRUFBNkM2QyxNQUE3QyxFQUFoQjs7QUFFQSxhQUFPO0FBQ0xkLGFBQUthLFNBQVNiLEdBQVQsR0FBZWUsVUFBVWYsR0FEekI7QUFFTEMsY0FBTVksU0FBU1osSUFBVCxHQUFnQmMsVUFBVWQ7QUFGM0IsT0FBUDtBQUlEO0FBckkyQyxHQUFyQixDQUF6Qjs7QUF3SUEsTUFBSXpDLGdCQUFKLENBQXFCO0FBQ25Cd0QsUUFBSTtBQURlLEdBQXJCO0FBSUQsQ0ExS0QsRUEwS0dDLE1BMUtILEVBMEtXQyxjQUFjQyxPQUFkLElBQXlCQyxPQUFPaEYsTUExSzNDLEUiLCJmaWxlIjoiXFxqc1xcYWRtaW5cXHNjaGVkdWxlLWNhbGVuZGFyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCQsIG1vbWVudCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgY29uc3QgREFURV9GT1JNQVQgPSAnWVlZWS1NTS1ERCc7XHJcblxyXG4gIGNvbnN0IFNlbGVjdGlvbiA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7XHJcbiAgICBkZWZhdWx0czoge1xyXG4gICAgICB1bml0OiBudWxsLFxyXG4gICAgICBlbmREYXRlOiBudWxsLFxyXG4gICAgICBzdGFydERhdGU6IG51bGwsXHJcbiAgICB9LFxyXG5cclxuICAgIHZhbGlkYXRlKGF0dHJzLCBvcHRpb25zKSB7XHJcbiAgICAgIC8vIC4uLlxyXG4gICAgfSxcclxuXHJcbiAgICBjbGVhclNlbGVjdGVkRGF0ZShuZXdVbml0KSB7XHJcbiAgICAgIHRoaXMuc2V0KHsgc3RhcnREYXRlOiBudWxsLCBlbmREYXRlOiBudWxsIH0pO1xyXG4gICAgICB0aGlzLnNldCgndW5pdCcsIG5ld1VuaXQpO1xyXG4gICAgfSxcclxuXHJcbiAgICBnZXROaWdodHMoKSB7XHJcbiAgICAgIGlmICghIHRoaXMuaGFzKCdlbmREYXRlJykgfHwgISB0aGlzLmhhcygnc3RhcnREYXRlJykpIHtcclxuICAgICAgICByZXR1cm4gMDtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdlbmREYXRlJykuZGlmZih0aGlzLmdldCgnc3RhcnREYXRlJyksICdkYXlzJyk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IFNjaGVkdWxlQ2FsZW5kYXIgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7XHJcbiAgICBvcHRpb25zOiB7XHJcbiAgICAgIGRlYnVnOiB0cnVlLFxyXG4gICAgICBtYXJrZXI6ICcuYXdlYm9va2luZy1zY2hlZHVsZV9fbWFya2VyJyxcclxuICAgIH0sXHJcblxyXG4gICAgZXZlbnRzOiB7XHJcbiAgICAgICdjbGljayAuYXdlYm9va2luZy1zY2hlZHVsZV9fZGF5JzogJ3NldFNlbGVjdGlvbkRhdGUnLFxyXG4gICAgICAnbW91c2VlbnRlciAuYXdlYm9va2luZy1zY2hlZHVsZV9fZGF5JzogJ2RyYXdNYXJrZXJPbkhvdmVyJyxcclxuICAgIH0sXHJcblxyXG4gICAgaW5pdGlhbGl6ZSgpIHtcclxuICAgICAgdGhpcy5tb2RlbCA9IG5ldyBTZWxlY3Rpb247XHJcblxyXG4gICAgICB0aGlzLiRtYXJrZXIgPSB0aGlzLiRlbC5maW5kKHRoaXMub3B0aW9ucy5tYXJrZXIpO1xyXG4gICAgICB0aGlzLiRtYXJrZXIuaGlkZSgpO1xyXG5cclxuICAgICAgJChkb2N1bWVudCkub24oJ2tleXVwJywgdGhpcy5rZXl1cC5iaW5kKHRoaXMpKTtcclxuICAgICAgLy8gJChkb2N1bWVudCkub2ZmKCdrZXl1cCcsIHRoaXMua2V5dXApO1xyXG5cclxuICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCAnY2hhbmdlOnN0YXJ0RGF0ZSBjaGFuZ2U6ZW5kRGF0ZScsIHRoaXMuc2V0TWFya2VyUG9zaXRpb24pO1xyXG4gICAgICBpZiAodGhpcy5vcHRpb25zLmRlYnVnKSB7XHJcbiAgICAgICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCAnY2hhbmdlJywgdGhpcy5kZWJ1Zyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuJGVsLmRhdGEoJ3NjaGVkdWxlLWNhbGVuZGFyJywgdGhpcyk7XHJcbiAgICB9LFxyXG5cclxuICAgIGRlYnVnICgpIHtcclxuICAgICAgaWYgKHRoaXMubW9kZWwuaGFzKCdzdGFydERhdGUnKSAmJiB0aGlzLm1vZGVsLmhhcygnZW5kRGF0ZScpKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5tb2RlbC5nZXQoJ3VuaXQnKSwgdGhpcy5tb2RlbC5nZXQoJ3N0YXJ0RGF0ZScpLmZvcm1hdChEQVRFX0ZPUk1BVCkgKyAnIC0gJyArIHRoaXMubW9kZWwuZ2V0KCdlbmREYXRlJykuZm9ybWF0KERBVEVfRk9STUFUKSk7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5tb2RlbC5oYXMoJ3N0YXJ0RGF0ZScpKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5tb2RlbC5nZXQoJ3VuaXQnKSwgdGhpcy5tb2RlbC5nZXQoJ3N0YXJ0RGF0ZScpLmZvcm1hdChEQVRFX0ZPUk1BVCkgKyAnIC0gbnVsbCcpO1xyXG4gICAgICB9IGVsc2UgaWYodGhpcy5tb2RlbC5oYXMoJ2VuZERhdGUnKSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMubW9kZWwuZ2V0KCd1bml0JyksICdudWxsJyArICcgLSAnICsgdGhpcy5tb2RlbC5nZXQoJ2VuZERhdGUnKS5mb3JtYXQoREFURV9GT1JNQVQpKTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBrZXl1cChlKSB7XHJcbiAgICAgIGlmIChlLmtleUNvZGUgPT0gMjcpIHtcclxuICAgICAgICB0aGlzLm1vZGVsLmNsZWFyU2VsZWN0ZWREYXRlKCk7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgc2V0U2VsZWN0aW9uRGF0ZShlKSB7XHJcbiAgICAgIGNvbnN0ICR0YXJnZXQgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICAgIGNvbnN0IHNldFVuaXQgPSB0aGlzLmdldFVuaXRCeUVsZW1lbnQoJHRhcmdldCk7XHJcbiAgICAgIGNvbnN0IGNsaWNrRGF0ZSA9IG1vbWVudCgkdGFyZ2V0LmRhdGEoJ2RhdGUnKSk7XHJcblxyXG4gICAgICBpZiAodGhpcy5tb2RlbC5oYXMoJ3VuaXQnKSAmJiBzZXRVbml0ICE9PSB0aGlzLm1vZGVsLmdldCgndW5pdCcpXHJcbiAgICAgICAgICB8fCB0aGlzLm1vZGVsLmhhcygnc3RhcnREYXRlJykgJiYgdGhpcy5tb2RlbC5oYXMoJ2VuZERhdGUnKVxyXG4gICAgICAgICAgfHwgdGhpcy5tb2RlbC5oYXMoJ3N0YXJ0RGF0ZScpICYmIGNsaWNrRGF0ZS5pc0JlZm9yZSh0aGlzLm1vZGVsLmdldCgnc3RhcnREYXRlJyksICdkYXknKSkge1xyXG4gICAgICAgIHRoaXMubW9kZWwuY2xlYXJTZWxlY3RlZERhdGUoc2V0VW5pdCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICghdGhpcy5tb2RlbC5oYXMoJ3N0YXJ0RGF0ZScpICYmICF0aGlzLm1vZGVsLmhhcygnZW5kRGF0ZScpKSB7XHJcbiAgICAgICAgdGhpcy5tb2RlbC5zZXQoJ3VuaXQnLCBzZXRVbml0KTtcclxuICAgICAgICB0aGlzLm1vZGVsLnNldCgnc3RhcnREYXRlJywgY2xpY2tEYXRlLmNsb25lKCkpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMubW9kZWwuc2V0KCdlbmREYXRlJywgY2xpY2tEYXRlLmNsb25lKCkpO1xyXG4gICAgICAgIHRoaXMudHJpZ2dlcignYXBwbHknLCB0aGlzLm1vZGVsLCB0aGlzKTtcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLm1vZGVsLmdldE5pZ2h0cygpKTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBzZXRNYXJrZXJQb3NpdGlvbigpIHtcclxuICAgICAgY29uc3QgZW5kRGF0ZSA9IHRoaXMubW9kZWwuZ2V0KCdlbmREYXRlJyk7XHJcbiAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IHRoaXMubW9kZWwuZ2V0KCdzdGFydERhdGUnKTtcclxuXHJcbiAgICAgIGlmIChfLmlzTnVsbChzdGFydERhdGUpICYmIF8uaXNOdWxsKGVuZERhdGUpKSB7XHJcbiAgICAgICAgdGhpcy4kbWFya2VyLmNzcygnd2lkdGgnLCA2MCkuaGlkZSgpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgJHN0YXJ0RGF0ZUVsID0gdGhpcy5nZXRFbGVtZW50QnlEYXRlKHRoaXMubW9kZWwuZ2V0KCd1bml0JyksIHN0YXJ0RGF0ZSk7XHJcbiAgICAgIGlmIChfLmlzTnVsbChlbmREYXRlKSkge1xyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5nZXRDZWxsUG9zc2l0b24oJHN0YXJ0RGF0ZUVsKTtcclxuICAgICAgICB0aGlzLiRtYXJrZXIuc2hvdygpLmNzcyh7IHRvcDogcG9zaXRpb24udG9wLCBsZWZ0OiBwb3NpdGlvbi5sZWZ0IH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0ICRlbmREYXRlRWwgPSB0aGlzLmdldEVsZW1lbnRCeURhdGUodGhpcy5tb2RlbC5nZXQoJ3VuaXQnKSwgZW5kRGF0ZSk7XHJcbiAgICAgICAgdGhpcy4kbWFya2VyLmNzcygnd2lkdGgnLCAoJGVuZERhdGVFbC5pbmRleCgpIC0gJHN0YXJ0RGF0ZUVsLmluZGV4KCkgKyAxKSAqIDYwKTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBkcmF3TWFya2VyT25Ib3ZlcihlKSB7XHJcbiAgICAgIGNvbnN0ICR0YXJnZXQgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICAgIGNvbnN0IHRhcmdldFVuaXQgPSB0aGlzLmdldFVuaXRCeUVsZW1lbnQoJHRhcmdldCk7XHJcblxyXG4gICAgICBpZiAoIXRoaXMubW9kZWwuaGFzKCd1bml0JylcclxuICAgICAgICB8fCB0aGlzLm1vZGVsLmdldCgndW5pdCcpICE9PSB0YXJnZXRVbml0XHJcbiAgICAgICAgfHwgIXRoaXMubW9kZWwuaGFzKCdzdGFydERhdGUnKVxyXG4gICAgICAgIHx8IHRoaXMubW9kZWwuaGFzKCdzdGFydERhdGUnKSAmJiB0aGlzLm1vZGVsLmhhcygnZW5kRGF0ZScpKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBob3ZlckRhdGUgPSBtb21lbnQoJHRhcmdldC5kYXRhKCdkYXRlJykpO1xyXG4gICAgICBjb25zdCBzdGFydERhdGUgPSB0aGlzLm1vZGVsLmdldCgnc3RhcnREYXRlJyk7XHJcblxyXG4gICAgICBpZiAoc3RhcnREYXRlLmlzU2FtZU9yQmVmb3JlKGhvdmVyRGF0ZSwgJ2RheScpKSB7XHJcbiAgICAgICAgY29uc3QgJHN0YXJ0RGF0ZUVsID0gdGhpcy5nZXRFbGVtZW50QnlEYXRlKHRhcmdldFVuaXQsIHN0YXJ0RGF0ZSk7XHJcbiAgICAgICAgdGhpcy4kbWFya2VyLmNzcygnd2lkdGgnLCAoJHRhcmdldC5pbmRleCgpIC0gJHN0YXJ0RGF0ZUVsLmluZGV4KCkgKyAxKSAqIDYwKTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBnZXRFbGVtZW50QnlEYXRlKHVuaXQsIGRhdGUpIHtcclxuICAgICAgaWYgKHR5cGVvZiBkYXRlID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIGRhdGUgPSBkYXRlLmZvcm1hdChEQVRFX0ZPUk1BVCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB0aGlzLiRlbFxyXG4gICAgICAgIC5maW5kKCdbZGF0YS11bml0PVwiJyArIHVuaXQgKyAnXCJdJylcclxuICAgICAgICAuZmluZCgnLmF3ZWJvb2tpbmctc2NoZWR1bGVfX2RheVtkYXRhLWRhdGU9XCInICsgZGF0ZSArICdcIl0nKTtcclxuICAgIH0sXHJcblxyXG4gICAgZ2V0VW5pdEJ5RWxlbWVudChlbGVtZW50KSB7XHJcbiAgICAgIGxldCB1bml0ID0gJChlbGVtZW50KS5kYXRhKCd1bml0Jyk7XHJcblxyXG4gICAgICBpZiAodHlwZW9mIHVuaXQgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgdW5pdCA9ICQoZWxlbWVudCkuY2xvc2VzdCgnW2RhdGEtdW5pdF0nKS5kYXRhKCd1bml0Jyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHVuaXQgPSBwYXJzZUludCh1bml0LCAxMCk7XHJcbiAgICAgIHJldHVybiAhIGlzTmFOKHVuaXQpID8gdW5pdCA6IDA7XHJcbiAgICB9LFxyXG5cclxuICAgIGdldENlbGxQb3NzaXRvbihlbGVtZW50KSB7XHJcbiAgICAgIHZhciBjaGlsZFBvcyA9IGVsZW1lbnQub2Zmc2V0KCk7XHJcbiAgICAgIHZhciBwYXJlbnRQb3MgPSB0aGlzLiRlbC5maW5kKCcuYXdlYm9va2luZy1zY2hlZHVsZV9fdGJvZHknKS5vZmZzZXQoKTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgdG9wOiBjaGlsZFBvcy50b3AgLSBwYXJlbnRQb3MudG9wLFxyXG4gICAgICAgIGxlZnQ6IGNoaWxkUG9zLmxlZnQgLSBwYXJlbnRQb3MubGVmdFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBuZXcgU2NoZWR1bGVDYWxlbmRhcih7XHJcbiAgICBlbDogJy5hd2Vib29raW5nLXNjaGVkdWxlJ1xyXG4gIH0pO1xyXG5cclxufSkoalF1ZXJ5LCBUaGVBd2VCb29raW5nLm1vbW1lbnQgfHwgd2luZG93Lm1vbWVudCk7XHJcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL2Fzc2V0cy9qc3NyYy9hZG1pbi9jYWxlbmRhci9zY2hlZHVsZS1jYWxlbmRhci5qcyJdLCJzb3VyY2VSb290IjoiIn0=